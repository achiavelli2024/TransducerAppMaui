<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="TransducerAppMaui.Views.FreeTestPage"
    Title="Transducer">

    <ScrollView>
        <VerticalStackLayout Padding="8" Spacing="8" BackgroundColor="#FAFAFA">

            <!-- =========================
                 CARD: Connection
                 ========================= -->
            <Frame Padding="10" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Connection" FontAttributes="Bold" FontSize="14" TextColor="#212121"/>

                    <!-- IP + Buttons -->
                    <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="6" VerticalOptions="Center">
                        <Label Text="IP:" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="IpEntry"
                               Grid.Column="1"
                               Placeholder="192.168.4.1"
                               HorizontalTextAlignment="Center"
                               FontSize="12"
                               HeightRequest="36"
                               TextColor="#212121"/>

                        <Button x:Name="ConnectButton"
                                Grid.Column="2"
                                Text="Connect"
                                FontSize="10"
                                HeightRequest="36"/>

                        <Button x:Name="DisconnectButton"
                                Grid.Column="3"
                                Text="Disconnect"
                                FontSize="10"
                                HeightRequest="36"
                                IsVisible="False"/>
                    </Grid>

                    <!-- Status row: indicator + status + switches -->
                    <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto" ColumnSpacing="8" VerticalOptions="Center">
                        <Label x:Name="ConnectionIndicator"
                               Text="●"
                               FontSize="16"
                               TextColor="#F44336"
                               VerticalOptions="Center"/>

                        <Label x:Name="ConnectionStatusLabel"
                               Grid.Column="1"
                               Text="Disconnected"
                               FontSize="12"
                               TextColor="#616161"
                               FontAttributes="Italic"
                               VerticalOptions="Center"/>

                        <HorizontalStackLayout Grid.Column="3" Spacing="10" VerticalOptions="Center">
                            <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                <Switch x:Name="ShowTraceSwitch" IsToggled="False"/>
                                <Label Text="Show trace" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                            </HorizontalStackLayout>

                            <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                <Switch x:Name="ShowStatsSwitch" IsToggled="False"/>
                                <Label Text="Show Stats" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                            </HorizontalStackLayout>
                        </HorizontalStackLayout>
                    </Grid>

                    <!-- Reconnect + Uptime -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                        <Label x:Name="ReconnectCountLabel" Text="Reconnection: 0" />
                        <Label x:Name="UptimeLabel" Grid.Column="1" Text="Uptime: 00:00:00" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- =========================
                 CARD: Live values
                 ========================= -->
            <Frame Padding="10" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="8">

                    <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                        <Label x:Name="TestIndicator"
                               Text="●"
                               FontSize="16"
                               TextColor="#F44336"
                               VerticalOptions="Center"/>

                        <Label Text="Live values"
                               FontAttributes="Bold"
                               FontSize="14"
                               TextColor="#212121"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <!-- Torque -->
                        <VerticalStackLayout Spacing="2">
                            <Label Text="Torque" FontSize="12" TextColor="#757575"/>
                            <Label x:Name="TorqueLabel" Text="0.000 Nm" FontSize="16" FontAttributes="Bold" TextColor="#212121"/>
                        </VerticalStackLayout>

                        <!-- Angle -->
                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                            <Label Text="Angle" FontSize="12" TextColor="#757575"/>
                            <Label x:Name="AngleLabel" Text="0.00 º" FontSize="16" FontAttributes="Bold" TextColor="#212121"/>
                        </VerticalStackLayout>

                        <!-- Results -->
                        <VerticalStackLayout Grid.Column="2" Spacing="2">
                            <Label Text="Results" FontSize="12" TextColor="#757575"/>
                            <Label x:Name="ResultsCounterLabel" Text="0" FontSize="16" FontAttributes="Bold" TextColor="#212121"/>
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- =========================
                 CARD: Parameters
                 ========================= -->
            <Frame Padding="10" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Parameters" FontAttributes="Bold" FontSize="14" TextColor="#212121"/>

                    <!-- Threshold / Timeout / Frequency -->
                    <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="4" RowSpacing="6">
                        <Label Text="Threshold:" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="ThresholdEntry" Grid.Column="1" WidthRequest="70" HeightRequest="36"
                               HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>

                        <Label Text="Timeout:" Grid.Column="2" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="TimeoutEntry" Grid.Column="3" WidthRequest="70" HeightRequest="36"
                               HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>

                        <Label Text="Frequency:" Grid.Column="4" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="FrequencyEntry" Grid.Column="5" WidthRequest="80" HeightRequest="36"
                               HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>
                    </Grid>

                    <!-- Min / Nom / Max torque -->
                    <Grid ColumnDefinitions="Auto,*,Auto,*,Auto,*" ColumnSpacing="6">
                        <Label Text="Min:" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="MinTorqueEntry" Grid.Column="1" HeightRequest="36" HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>

                        <Label Text="Nom:" Grid.Column="2" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="NomTorqueEntry" Grid.Column="3" HeightRequest="36" HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>

                        <Label Text="Max:" Grid.Column="4" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="MaxTorqueEntry" Grid.Column="5" HeightRequest="36" HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>
                    </Grid>

                    <!-- Tool type -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8" VerticalOptions="Center">
                        <Label Text="Tool:" FontAttributes="Bold" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Picker x:Name="ToolTypePicker" Grid.Column="1" Title="Select tool type" HeightRequest="40"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- =========================
                 CARD: Status + Results history
                 ========================= -->
            <Frame Padding="10" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="8">

                    <Label x:Name="StatusLabel"
                           Text="Status: Idle"
                           FontSize="12"
                           FontAttributes="Italic"
                           TextColor="#616161"/>

                    <!-- Stats summary -->
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                        <Label x:Name="MainStatsMeanLabel" Text="Mean: n/a" Padding="6" />
                        <Label x:Name="MainStatsCmLabel" Grid.Column="1" Text="Cm: n/a" Padding="6" />
                        <Label x:Name="MainStatsCmkLabel" Grid.Column="2" Text="Cmk: n/a" Padding="6" />
                    </Grid>

                    <!-- Title + buttons -->
                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8" VerticalOptions="Center">
                        <Label Text="Results history" FontAttributes="Bold" FontSize="12" TextColor="#212121" VerticalOptions="Center"/>
                        <Button x:Name="ExportResultsButton" Grid.Column="1" Text="EXPORT RESULTS" FontSize="10" HeightRequest="36"/>
                        <Button x:Name="ClearResultsButton" Grid.Column="2" Text="Clean Results" FontSize="10" HeightRequest="36"/>
                    </Grid>

                    <!-- Results list -->
                    <CollectionView x:Name="ResultsCollection"
                                    HeightRequest="160"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Label Text="{Binding .}" FontSize="12" TextColor="#212121" />
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                </VerticalStackLayout>
            </Frame>

            <!-- =========================
                 CARD: Control + Debug
                 ========================= -->
            <Frame Padding="10" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="10">

                    <!-- Main buttons -->
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                        <Button x:Name="InitReadButton" Text="Init Read" FontSize="10" HeightRequest="40"/>
                        <Button x:Name="StopReadButton" Grid.Column="1" Text="Stop" FontSize="10" HeightRequest="40"/>
                        <Button x:Name="ZeroButton" Grid.Column="2" Text="Zero Tq An" FontSize="10" HeightRequest="40"/>
                    </Grid>

                    <!-- Debug panel (starts hidden like Xamarin) -->
                    <VerticalStackLayout x:Name="DebugPanel" IsVisible="False" Spacing="8">

                        <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto" ColumnSpacing="8" VerticalOptions="Center">
                            <Button x:Name="ClearLogButton" Text="Clear Log" FontSize="10" HeightRequest="36"/>
                            <Button x:Name="CopyLogButton" Grid.Column="1" Text="Copy Log" FontSize="10" HeightRequest="36"/>

                            <Label Grid.Column="2" Text="Show Logs" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                            <Switch x:Name="ShowLogsSwitch" Grid.Column="4" IsToggled="True"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="8" VerticalOptions="Center">
                            <Label Text="Pause Logs" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                            <Switch x:Name="PauseLogsSwitch" Grid.Column="1" IsToggled="False"/>

                            <Button x:Name="ExportLogsButton" Grid.Column="3" Text="EXPORT LOGS" FontSize="10" HeightRequest="36"/>
                        </Grid>

                        <Label Text="Logs" FontAttributes="Bold" FontSize="12" TextColor="#212121"/>

                        <CollectionView x:Name="LogsCollection" HeightRequest="220" SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Label Text="{Binding .}" FontSize="12" TextColor="#212121" />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
