<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:res="clr-namespace:TransducerAppMaui.Resources.Strings"
    x:Class="TransducerAppMaui.Views.FreeTestPage"
    Title="{x:Static res:AppResources.FreeTest_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="8" Spacing="8" BackgroundColor="#FAFAFA">

            <!-- =========================
                 CARD: Connection
                 ========================= -->
            <Frame Padding="10" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="8">
                    <Label Text="{x:Static res:AppResources.FreeTest_Section_Connection}" FontAttributes="Bold" FontSize="14" TextColor="#212121"/>

                    <!-- IP + Buttons -->
                    <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="6" VerticalOptions="Center">
                        <Label Text="{x:Static res:AppResources.FreeTest_Label_Ip}" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="IpEntry"
                               Grid.Column="1"
                               Placeholder="{x:Static res:AppResources.FreeTest_Placeholder_Ip}"
                               HorizontalTextAlignment="Center"
                               FontSize="12"
                               HeightRequest="36"
                               TextColor="#212121"/>

                        <Button x:Name="ConnectButton"
                                Grid.Column="2"
                                Text="{x:Static res:AppResources.FreeTest_Button_Connect}"
                                FontSize="10"
                                HeightRequest="36"/>

                        <Button x:Name="DisconnectButton"
                                Grid.Column="3"
                                Text="{x:Static res:AppResources.FreeTest_Button_Disconnect}"
                                FontSize="10"
                                HeightRequest="36"
                                IsVisible="False"/>
                    </Grid>

                    <!-- Status row: indicator + status + switches -->
                    <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto" ColumnSpacing="8" VerticalOptions="Center">
                        <Label x:Name="ConnectionIndicator"
                               Text="●"
                               FontSize="16"
                               TextColor="#F44336"
                               VerticalOptions="Center"/>

                        <Label x:Name="ConnectionStatusLabel"
                               Grid.Column="1"
                               Text="{x:Static res:AppResources.FreeTest_Status_Disconnected}"
                               FontSize="12"
                               TextColor="#616161"
                               FontAttributes="Italic"
                               VerticalOptions="Center"/>

                        <HorizontalStackLayout Grid.Column="3" Spacing="10" VerticalOptions="Center">
                            <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                <Switch x:Name="ShowTraceSwitch" IsToggled="False"/>
                                <Label Text="{x:Static res:AppResources.FreeTest_Label_ShowTrace}" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                            </HorizontalStackLayout>

                            <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                                <Switch x:Name="ShowStatsSwitch" IsToggled="False"/>
                                <Label Text="{x:Static res:AppResources.FreeTest_Label_ShowStats}" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                            </HorizontalStackLayout>
                        </HorizontalStackLayout>
                    </Grid>

                    <!-- Reconnect + Uptime -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                        <Label x:Name="ReconnectCountLabel" Text="{x:Static res:AppResources.FreeTest_Label_Reconnection}" />
                        <Label x:Name="UptimeLabel" Grid.Column="1" Text="{x:Static res:AppResources.FreeTest_Label_Uptime}" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- =========================
                 CARD: Live values
                 ========================= -->
            <Frame Padding="10" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="8">

                    <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                        <Label x:Name="TestIndicator"
                               Text="●"
                               FontSize="16"
                               TextColor="#F44336"
                               VerticalOptions="Center"/>

                        <Label Text="{x:Static res:AppResources.FreeTest_Section_LiveValues}"
                               FontAttributes="Bold"
                               FontSize="14"
                               TextColor="#212121"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <!-- Torque -->
                        <VerticalStackLayout Spacing="2">
                            <Label Text="{x:Static res:AppResources.FreeTest_Label_Torque}" FontSize="12" TextColor="#757575"/>
                            <Label x:Name="TorqueLabel" Text="0.000 Nm" FontSize="16" FontAttributes="Bold" TextColor="#212121"/>
                        </VerticalStackLayout>

                        <!-- Angle -->
                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                            <Label Text="{x:Static res:AppResources.FreeTest_Label_Angle}" FontSize="12" TextColor="#757575"/>
                            <Label x:Name="AngleLabel" Text="0.00 º" FontSize="16" FontAttributes="Bold" TextColor="#212121"/>
                        </VerticalStackLayout>

                        <!-- Results -->
                        <VerticalStackLayout Grid.Column="2" Spacing="2">
                            <Label Text="{x:Static res:AppResources.FreeTest_Label_Results}" FontSize="12" TextColor="#757575"/>
                            <Label x:Name="ResultsCounterLabel" Text="0" FontSize="16" FontAttributes="Bold" TextColor="#212121"/>
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- =========================
                 CARD: Parameters
                 ========================= -->
            <Frame Padding="10" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="8">
                    <Label Text="{x:Static res:AppResources.FreeTest_Section_Parameters}" FontAttributes="Bold" FontSize="14" TextColor="#212121"/>

                    <!-- Threshold / Timeout / Frequency -->
                    <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="4" RowSpacing="6">
                        <Label Text="{x:Static res:AppResources.FreeTest_Label_Threshold}" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="ThresholdEntry" Grid.Column="1" WidthRequest="70" HeightRequest="36"
                               HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>

                        <Label Text="{x:Static res:AppResources.FreeTest_Label_Timeout}" Grid.Column="2" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="TimeoutEntry" Grid.Column="3" WidthRequest="70" HeightRequest="36"
                               HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>

                        <Label Text="{x:Static res:AppResources.FreeTest_Label_Frequency}" Grid.Column="4" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="FrequencyEntry" Grid.Column="5" WidthRequest="80" HeightRequest="36"
                               HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>
                    </Grid>

                    <!-- Min / Nom / Max torque -->
                    <Grid ColumnDefinitions="Auto,*,Auto,*,Auto,*" ColumnSpacing="6">
                        <Label Text="{x:Static res:AppResources.FreeTest_Label_Min}" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="MinTorqueEntry" Grid.Column="1" HeightRequest="36" HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>

                        <Label Text="{x:Static res:AppResources.FreeTest_Label_Nom}" Grid.Column="2" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="NomTorqueEntry" Grid.Column="3" HeightRequest="36" HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>

                        <Label Text="{x:Static res:AppResources.FreeTest_Label_Max}" Grid.Column="4" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Entry x:Name="MaxTorqueEntry" Grid.Column="5" HeightRequest="36" HorizontalTextAlignment="Center" FontSize="12" Keyboard="Numeric"/>
                    </Grid>

                    <!-- Tool type -->
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8" VerticalOptions="Center">
                        <Label Text="{x:Static res:AppResources.FreeTest_Label_Tool}" FontAttributes="Bold" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                        <Picker x:Name="ToolTypePicker" Grid.Column="1" Title="{x:Static res:AppResources.FreeTest_Picker_ToolType_Title}" HeightRequest="40"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- =========================
                 CARD: Status + Results history
                 ========================= -->
            <Frame Padding="10" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="8">

                    <Label x:Name="StatusLabel"
                           Text="{x:Static res:AppResources.FreeTest_Status_Idle}"
                           FontSize="12"
                           FontAttributes="Italic"
                           TextColor="#616161"/>

                    <!-- Stats summary -->
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                        <Label x:Name="MainStatsMeanLabel" Text="{x:Static res:AppResources.FreeTest_Stats_Mean}" Padding="6" />
                        <Label x:Name="MainStatsCmLabel" Grid.Column="1" Text="{x:Static res:AppResources.FreeTest_Stats_Cm}" Padding="6" />
                        <Label x:Name="MainStatsCmkLabel" Grid.Column="2" Text="{x:Static res:AppResources.FreeTest_Stats_Cmk}" Padding="6" />
                    </Grid>

                    <!-- Title + buttons -->
                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8" VerticalOptions="Center">
                        <Label Text="{x:Static res:AppResources.FreeTest_Section_ResultsHistory}" FontAttributes="Bold" FontSize="12" TextColor="#212121" VerticalOptions="Center"/>
                        <Button x:Name="ExportResultsButton" Grid.Column="1" Text="{x:Static res:AppResources.FreeTest_Button_ExportResults}" FontSize="10" HeightRequest="36"/>
                        <Button x:Name="ClearResultsButton" Grid.Column="2" Text="{x:Static res:AppResources.FreeTest_Button_ClearResults}" FontSize="10" HeightRequest="36"/>
                    </Grid>

                    <!-- Results list -->
                    <CollectionView x:Name="ResultsCollection"
                                    HeightRequest="160"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Label Text="{Binding .}" FontSize="12" TextColor="#212121" />
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                </VerticalStackLayout>
            </Frame>

            <!-- =========================
                 CARD: Control + Debug
                 ========================= -->
            <Frame Padding="10" CornerRadius="10" BackgroundColor="White" HasShadow="True">
                <VerticalStackLayout Spacing="10">

                    <!-- Main buttons -->
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                        <Button x:Name="InitReadButton" Text="{x:Static res:AppResources.FreeTest_Button_InitRead}" FontSize="10" HeightRequest="40"/>
                        <Button x:Name="StopReadButton" Grid.Column="1" Text="{x:Static res:AppResources.FreeTest_Button_Stop}" FontSize="10" HeightRequest="40"/>
                        <Button x:Name="ZeroButton" Grid.Column="2" Text="{x:Static res:AppResources.FreeTest_Button_Zero}" FontSize="10" HeightRequest="40"/>
                    </Grid>

                    <!-- Debug panel (starts hidden like Xamarin) -->
                    <VerticalStackLayout x:Name="DebugPanel" IsVisible="False" Spacing="8">

                        <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto" ColumnSpacing="8" VerticalOptions="Center">
                            <Button x:Name="ClearLogButton" Text="{x:Static res:AppResources.FreeTest_Button_ClearLog}" FontSize="10" HeightRequest="36"/>
                            <Button x:Name="CopyLogButton" Grid.Column="1" Text="{x:Static res:AppResources.FreeTest_Button_CopyLog}" FontSize="10" HeightRequest="36"/>

                            <Label Grid.Column="2" Text="{x:Static res:AppResources.FreeTest_Label_ShowLogs}" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                            <Switch x:Name="ShowLogsSwitch" Grid.Column="4" IsToggled="True"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="8" VerticalOptions="Center">
                            <Label Text="{x:Static res:AppResources.FreeTest_Label_PauseLogs}" FontSize="12" TextColor="#424242" VerticalOptions="Center"/>
                            <Switch x:Name="PauseLogsSwitch" Grid.Column="1" IsToggled="False"/>

                            <Button x:Name="ExportLogsButton" Grid.Column="3" Text="{x:Static res:AppResources.FreeTest_Button_ExportLogs}" FontSize="10" HeightRequest="36"/>
                        </Grid>

                        <Label Text="{x:Static res:AppResources.FreeTest_Section_Logs}" FontAttributes="Bold" FontSize="12" TextColor="#212121"/>

                        <CollectionView x:Name="LogsCollection" HeightRequest="220" SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Label Text="{Binding .}" FontSize="12" TextColor="#212121" />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>